if(typeof akeeba=="undefined"){var akeeba={}}if(typeof akeeba.Restore=="undefined"){akeeba.Restore={errorCallback:null,statistics:{inbytes:0,outbytes:0,files:0},factory:null,password:null,ajaxURL:null,mainURL:null}}(function(a){akeeba.Restore.errorCallbackDefault=function(b){a("#restoration-progress").hide();a("#restoration-error").show();a("#backup-error-message").html(b)};akeeba.Restore.doAjax=function(h,b,e){json=JSON.stringify(h);if(akeeba.Restore.password.length>0){json=AesCtr.encrypt(json,akeeba.Restore.password,128)}var i={json:json};var f=new Date().getTime()/1000;var g=parseInt(f,10);var d=Math.round((f-g)*1000)/1000;i._cacheBustingJunk=d;var c={type:"POST",url:akeeba.Restore.ajaxURL,cache:false,data:i,timeout:600000,success:function(o){var n=null;var l="";var j=o.indexOf("###");if(j==-1){o="Invalid AJAX data: "+o;if(e==null){if(akeeba.Restore.errorCallback!=null){akeeba.Restore.errorCallback(o)}}else{e(o)}return}else{if(j!=0){n=o.substr(0,j);l=o.substr(j)}else{l=o}}l=l.substr(3);j=l.lastIndexOf("###");l=l.substr(0,j);if(akeeba.Restore.password.length>0){l=AesCtr.decrypt(l,akeeba.Restore.password,128)}try{var m=JSON.parse(l)}catch(k){errorMessage=k.message+"\n<br/>\n<pre>\n"+l+"\n</pre>";if(e==null){if(akeeba.Restore.errorCallback!=null){akeeba.Restore.errorCallback(errorMessage)}}else{e(errorMessage)}return}b(m)},error:function(j,m,l){var k="AJAX Loading Error: "+m;if(e==null){if(akeeba.Restore.errorCallback!=null){akeeba.Restore.errorCallback(k)}}else{e(k)}}};a.ajax(c)};akeeba.Restore.startTimeoutBar=function(c,b){var d=0;a("#response-timer div.text").everyTime(1000,"lastReponse",function(){d++;var e=Joomla.JText._("COM_AKEEBA_BACKUP_TEXT_LASTRESPONSE").replace("%s",d.toFixed(0));a("#response-timer div.text").html(e)})};akeeba.Restore.resetTimeoutBar=function(){a("#response-timer div.text").stopTime();var b=Joomla.JText._("COM_AKEEBA_BACKUP_TEXT_LASTRESPONSE").replace("%s","0");a("#response-timer div.text").html(b)};akeeba.Restore.pingRestoration=function(){akeeba.Restore.statistics.inbytes=0;akeeba.Restore.statistics.outbytes=0;akeeba.Restore.statistics.files=0;var b={task:"ping"};akeeba.Restore.startTimeoutBar(5000,80);akeeba.Restore.doAjax(b,function(c){akeeba.Restore.start(c)})};akeeba.Restore.start=function(){akeeba.Restore.statistics.inbytes=0;akeeba.Restore.statistics.outbytes=0;akeeba.Restore.statistics.files=0;var b={task:"startRestore"};akeeba.Restore.startTimeoutBar(5000,80);akeeba.Restore.doAjax(b,function(c){akeeba.Restore.step(c)})};akeeba.Restore.step=function(b){akeeba.Restore.resetTimeoutBar();if(b.status==false){akeeba.Restore.errorCallbackDefault(b.message)}else{if(b.done){akeeba.Restore.factory=b.factory;a("#restoration-progress").hide();a("#restoration-extract-ok").show()}else{akeeba.Restore.statistics.inbytes+=b.bytesIn;akeeba.Restore.statistics.outbytes+=b.bytesOut;akeeba.Restore.statistics.files+=b.files;a("#extbytesin").html(akeeba.Restore.statistics.inbytes);a("#extbytesout").html(akeeba.Restore.statistics.outbytes);a("#extfiles").html(akeeba.Restore.statistics.files);post={task:"stepRestore",factory:b.factory};akeeba.Restore.startTimeoutBar(5000,80);akeeba.Restore.doAjax(post,function(c){akeeba.Restore.step(c)})}}};akeeba.Restore.finalize=function(){var b={task:"finalizeRestore",factory:akeeba.Restore.factory};akeeba.Restore.startTimeoutBar(5000,80);akeeba.Restore.doAjax(b,function(c){akeeba.Restore.finished(c)})};akeeba.Restore.finished=function(){window.location=akeeba.Restore.mainURL};akeeba.Restore.runInstaller=function(){window.open("../installation/index.php","abiinstaller");(function(b){b("#restoration-finalize").show()})(akeeba.jQuery)}}(akeeba.jQuery));